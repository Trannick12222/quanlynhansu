<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<title>üè† Danh S√°ch L·ªõp - Tr∆∞·ªùng M·∫ßm Non Hoa H∆∞·ªõng D∆∞∆°ng</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>

<!-- TailwindCSS -->
<script src="https://cdn.tailwindcss.com"></script>
<script>
  tailwind.config = {
    theme: {
      extend: {
        colors: {
          'neutral': {
            'primary': '#16a34a',
            'secondary': '#6b7280',
            'accent': '#8b9aa8',
            'muted': '#94a3b8',
            'light': '#cbd5e1',
            'lighter': '#e2e8f0',
            'lightest': '#f1f5f9'
          },
          'background': {
            'primary': '#f8fafc',
            'secondary': '#f1f5f9',
            'muted': '#e2e8f0',
            'card': '#ffffff'
          }
        },
        fontFamily: {
          'system': ['Inter', '-apple-system', 'BlinkMacSystemFont', 'sans-serif']
        }
      }
    }
  }
</script>

<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<!-- Icons -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
</head>
<body class="bg-background-primary min-h-screen font-system">

<style>
.shadow-soft { box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05); }
.shadow-soft-lg { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); }

/* Custom scrollbar */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: #f1f5f9; }
::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
</style>

<div class="container mx-auto p-4 max-w-6xl">
  <div class="bg-white rounded-xl shadow-soft-lg border border-neutral-lighter overflow-hidden">
    <!-- Header Section -->
    <div class="bg-neutral-primary p-6 text-white">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
            <i class="fas fa-school text-lg"></i>
          </div>
          <div>
            <h1 class="text-xl font-semibold">Qu·∫£n L√Ω Danh S√°ch L·ªõp</h1>
            <p class="text-white/80 text-sm">Tr∆∞·ªùng M·∫ßm Non Hoa H∆∞·ªõng D∆∞∆°ng</p>
          </div>
        </div>
        <div class="bg-white/20 px-3 py-1 rounded-full text-sm font-medium">
          #LopHoc
        </div>
      </div>
    </div>
    
    <div class="p-6">
      <!-- Add Class Form -->
      <div class="bg-background-secondary/50 p-6 rounded-xl border border-neutral-lighter mb-6">
        <form class="space-y-4" id="form-add-class">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div>
              <label class="block text-neutral-secondary font-system font-semibold text-sm mb-2" for="ma_lop">
                <span class="mr-2">üè∑Ô∏è</span>M√£ L·ªõp
              </label>
              <input class="w-full p-3 border border-neutral-light rounded-lg focus:border-neutral-primary focus:outline-none transition-colors duration-200 font-system" 
                     id="ma_lop" placeholder="VD: L01" type="text"/>
            </div>
            <div>
              <label class="block text-neutral-secondary font-system font-semibold text-sm mb-2" for="ten_lop">
                <span class="mr-2">üè†</span>T√™n L·ªõp
              </label>
              <input class="w-full p-3 border border-neutral-light rounded-lg focus:border-neutral-primary focus:outline-none transition-colors duration-200 font-system" 
                     id="ten_lop" placeholder="VD: M·∫ßm Non A" type="text"/>
            </div>
            <div class="flex items-end">
              <button class="w-full px-6 py-3 bg-neutral-primary hover:bg-neutral-secondary text-white rounded-lg font-system font-semibold transition-colors duration-200" 
                      type="submit">
                <i class="fas fa-plus mr-2"></i>Th√™m L·ªõp
              </button>
            </div>
          </div>
        </form>
      </div>
      
      <!-- Classes Table -->
      <div class="bg-white rounded-xl shadow-soft border border-neutral-lighter overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-neutral-lightest">
              <tr>
                <th class="px-6 py-4 text-neutral-secondary font-system font-semibold text-sm text-center border-b border-neutral-lighter">STT</th>
                <th class="px-6 py-4 text-neutral-secondary font-system font-semibold text-sm text-center border-b border-neutral-lighter cursor-pointer hover:bg-neutral-light/50 transition-colors duration-200" 
                    onclick="sortTableByColumn(0)">
                  <span class="mr-2">üè∑Ô∏è</span>M√£ L·ªõp 
                  <i class="fas fa-sort ml-2 opacity-60"></i>
                </th>
                <th class="px-6 py-4 text-neutral-secondary font-system font-semibold text-sm text-center border-b border-neutral-lighter cursor-pointer hover:bg-neutral-light/50 transition-colors duration-200" 
                    onclick="sortTableByColumn(1)">
                  <span class="mr-2">üè†</span>T√™n L·ªõp 
                  <i class="fas fa-sort ml-2 opacity-60"></i>
                </th>
                <th class="px-6 py-4 text-neutral-secondary font-system font-semibold text-sm text-center border-b border-neutral-lighter">
                  <span class="mr-2">‚öôÔ∏è</span>H√†nh ƒê·ªông
                </th>
              </tr>
            </thead>
            <tbody id="class-table-body">
              <tr>
                <td colspan="4" class="px-6 py-12 text-center text-neutral-muted">
                  <div class="flex flex-col items-center space-y-4">
                    <span class="text-4xl">üè†</span>
                    <div class="font-system text-sm">ƒêang t·∫£i d·ªØ li·ªáu l·ªõp h·ªçc...</div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
    document.getElementById('form-add-class').onsubmit = async function(e) {
      e.preventDefault();
      const ma_lop = document.getElementById('ma_lop').value.trim();
      const ten_lop = document.getElementById('ten_lop').value.trim();
      const isEditing = document.getElementById('form-add-class').dataset.editing === "true";
      const endpoint = isEditing ? '/api/update-class' : '/api/classes';
      const payload = { ma_lop, ten_lop };
      console.log(isEditing ? 'üîÑ S·ª≠a l·ªõp:' : '‚ûï Th√™m l·ªõp:', payload);
      const res = await fetch(endpoint, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (res.ok) {
        console.log('‚úÖ Th√†nh c√¥ng');
        document.getElementById('form-add-class').reset();
        document.getElementById('ma_lop').readOnly = false;
        document.querySelector('#form-add-class button[type="submit"]').innerHTML = '<i class="fas fa-plus mr-2"></i>Th√™m L·ªõp';
        document.getElementById('form-add-class').dataset.editing = "false";
        await reloadClassTable();
      } else {
        console.error('‚ùå L·ªói khi g·ª≠i d·ªØ li·ªáu');
      }
    };
    
    window.onload = async () => {
      const res = await fetch('/api/classes');
      const data = await res.json();
      const tbody = document.getElementById('class-table-body');
      tbody.innerHTML = data.map((row, index) => `
        <tr class="hover:bg-neutral-lighter/30 transition-colors duration-200 border-b border-neutral-lighter">
          <td class="px-6 py-4 font-system font-semibold text-neutral-muted text-center">${index + 1}</td>
          <td class="px-6 py-4 font-system text-neutral-secondary text-center font-semibold">${row.ma_lop}</td>
          <td class="px-6 py-4 font-system text-neutral-secondary">${row.ten_lop}</td>
          <td class="px-6 py-4 text-center">
            <div class="flex justify-center space-x-2">
              <button class="px-3 py-2 bg-neutral-accent hover:bg-neutral-muted text-white rounded-lg transition-colors duration-200" 
                      onclick="editClass('${row.ma_lop}', '${row.ten_lop}')">
                <i class="fas fa-edit mr-1"></i>S·ª≠a
              </button>
              <button class="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors duration-200" 
                      onclick="deleteClass('${row.ma_lop}')">
                <i class="fas fa-trash mr-1"></i>X√≥a
              </button>
            </div>
          </td>
        </tr>
      `).join("");
    };

    function editClass(ma_lop, ten_lop) {
      console.log('‚úèÔ∏è ƒêang s·ª≠a l·ªõp:', ma_lop);
      document.getElementById('ma_lop').value = ma_lop;
      document.getElementById('ma_lop').readOnly = true;
      document.getElementById('ten_lop').value = ten_lop;
      document.querySelector('#form-add-class button[type="submit"]').innerHTML = '<i class="fas fa-save mr-2"></i>C·∫≠p Nh·∫≠t';
      document.getElementById('form-add-class').dataset.editing = "true";
    }

    async function deleteClass(ma_lop) {
      if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a l·ªõp n√†y?")) {
        console.log('üóëÔ∏è Xo√° l·ªõp:', ma_lop);
        const res = await fetch('/api/delete-class', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify({ ma_lop })
        });
        if (res.ok) location.reload();
        else console.error('‚ùå L·ªói khi xo√° l·ªõp');
      }
    }

    let currentSortColumn = null;
    let sortAsc = true;

    function sortTableByColumn(columnIndex) {
      const tbody = document.getElementById("class-table-body");
      const rows = Array.from(tbody.querySelectorAll("tr"));
      if (currentSortColumn === columnIndex) {
        sortAsc = !sortAsc;
      } else {
        sortAsc = true;
        currentSortColumn = columnIndex;
      }
      rows.sort((a, b) => {
        const cellA = a.children[columnIndex].textContent.trim().toLowerCase();
        const cellB = b.children[columnIndex].textContent.trim().toLowerCase();
        return sortAsc ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
      });
      tbody.innerHTML = "";
      rows.forEach(row => tbody.appendChild(row));
    }

    async function reloadClassTable() {
      const res = await fetch('/api/classes');
      const data = await res.json();
      const tbody = document.getElementById('class-table-body');
      tbody.innerHTML = data.map((row, index) => `
        <tr class="hover:bg-neutral-lighter/30 transition-colors duration-200 border-b border-neutral-lighter">
          <td class="px-6 py-4 font-system font-semibold text-neutral-muted text-center">${index + 1}</td>
          <td class="px-6 py-4 font-system text-neutral-secondary text-center font-semibold">${row.ma_lop}</td>
          <td class="px-6 py-4 font-system text-neutral-secondary">${row.ten_lop}</td>
          <td class="px-6 py-4 text-center">
            <div class="flex justify-center space-x-2">
              <button class="px-3 py-2 bg-neutral-accent hover:bg-neutral-muted text-white rounded-lg transition-colors duration-200" 
                      onclick="editClass('${row.ma_lop}', '${row.ten_lop}')">
                <i class="fas fa-edit mr-1"></i>S·ª≠a
              </button>
              <button class="px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors duration-200" 
                      onclick="deleteClass('${row.ma_lop}')">
                <i class="fas fa-trash mr-1"></i>X√≥a
              </button>
            </div>
          </td>
        </tr>
      `).join("");
    }
</script>
</body>
</html>